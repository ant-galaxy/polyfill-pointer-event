{"version":3,"file":"main.js","sources":["../src/PointerEvent.ts","../src/PointerPolyfill.ts"],"sourcesContent":["import { PointerPolyfill } from \"./PointerPolyfill\";\n\nexport class PointerEvent extends Event {\n  public pointerType: string;\n  public pointerId: number;\n  public offsetX: number;\n  public offsetY: number;\n\n  constructor(type: string) {\n    super(type);\n  }\n\n  public static createFromTouch(type: string, touch: Touch): PointerEvent {\n    var e = new PointerEvent(type);\n    e.pointerType = \"touch\";\n    e.pointerId = (touch.identifier || 0) + 2;\n    e.offsetX = touch.pageX - PointerPolyfill.canvas.offsetLeft;\n    e.offsetY = touch.pageY - PointerPolyfill.canvas.offsetTop;\n    return e;\n  }\n}\n","import { PointerEvent } from \"./PointerEvent\";\n\nexport class PointerPolyfill {\n  public static canvas: HTMLCanvasElement;\n  static register(canvas: HTMLCanvasElement) {\n    if (window.PointerEvent) {\n      console.info(\"支持 PointerEvent \");\n      return;\n    }\n    if (PointerPolyfill.canvas) {\n      if (PointerPolyfill.canvas === canvas) {\n        console.info(\"已经注册了画布\", canvas);\n        return;\n      } else {\n        PointerPolyfill.unregister();\n      }\n    }\n    PointerPolyfill.canvas = canvas;\n    canvas.addEventListener(\"touchstart\", PointerPolyfill.onTouchStart);\n    canvas.addEventListener(\"touchmove\", PointerPolyfill.onTouchMove);\n    canvas.addEventListener(\"touchend\", PointerPolyfill.onTouchEnd);\n    canvas.addEventListener(\"touchcancel\", PointerPolyfill.onTouchCancel);\n  }\n\n  static unregister() {\n    if (PointerPolyfill.canvas) {\n      const canvas = PointerPolyfill.canvas;\n      canvas.removeEventListener(\"touchstart\", PointerPolyfill.onTouchStart);\n      canvas.removeEventListener(\"touchmove\", PointerPolyfill.onTouchMove);\n      canvas.removeEventListener(\"touchend\", PointerPolyfill.onTouchEnd);\n      canvas.removeEventListener(\"touchcancel\", PointerPolyfill.onTouchCancel);\n      PointerPolyfill.canvas = null;\n    }\n  }\n\n  private static onTouchStart(evt: TouchEvent) {\n    const { canvas } = PointerPolyfill;\n    if (!canvas) {\n      return;\n    }\n    var changedTouches = evt.changedTouches || evt.touches;\n    for (var i = 0; i < changedTouches.length; i++) {\n      // @ts-ignore\n      canvas.onpointerdown(PointerEvent.createFromTouch(\"pointerdown\", changedTouches[i]));\n    }\n  }\n\n  private static onTouchEnd(evt: TouchEvent) {\n    const { canvas } = PointerPolyfill;\n    if (!canvas) {\n      return;\n    }\n    var changedTouches = evt.changedTouches || evt.touches;\n    for (var i = 0; i < changedTouches.length; i++) {\n      var touch = changedTouches[i];\n      // @ts-ignore\n      canvas.onpointerup(PointerEvent.createFromTouch(\"pointerup\", touch));\n      // @ts-ignore\n      canvas.onpointerout(PointerEvent.createFromTouch(\"pointerout\", touch));\n    }\n  }\n\n  private static onTouchMove(evt: TouchEvent) {\n    const { canvas } = PointerPolyfill;\n    if (!canvas) {\n      return;\n    }\n    var changedTouches = evt.changedTouches || evt.touches;\n    for (var i = 0; i < changedTouches.length; i++) {\n      // @ts-ignore\n      canvas.onpointermove(PointerEvent.createFromTouch(\"pointermove\", changedTouches[i]));\n    }\n  }\n\n  private static onTouchCancel(evt: TouchEvent) {\n    const { canvas } = PointerPolyfill;\n    if (!canvas) {\n      return;\n    }\n    var changedTouches = evt.changedTouches || evt.touches;\n    for (var i = 0; i < changedTouches.length; i++) {\n      // @ts-ignore\n      canvas.onpointerout(PointerEvent.createFromTouch(\"pointerout\", changedTouches[i]));\n    }\n  }\n}\n"],"names":["PointerEvent","type","pointerType","pointerId","offsetX","offsetY","createFromTouch","touch","e","identifier","pageX","PointerPolyfill","canvas","offsetLeft","pageY","offsetTop","Event","register","window","console","info","unregister","addEventListener","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","removeEventListener","evt","changedTouches","touches","i","length","onpointerdown","onpointerup","onpointerout","onpointermove"],"mappings":"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"}